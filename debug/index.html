<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="x-ua-compatible" content="IE=edge">
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <meta charset=utf-8 />
  <title>Mapbox GL Draw | Mapbox</title>
  <link href='/mapbox-gl.css' rel='stylesheet' />
  <link href='/dist/mapbox-gl-draw.css' rel='stylesheet' />
  <style>
    body { margin:0; padding:0; }
    html, body, #map { height: 100%; }
    .start-draw {
      width: 237px;
      position: absolute;
      left :10px;
      bottom: 10px;
      background: #efefef;
    }
    .start-draw div {
      float: right;
      border: 1px solid #ccc;
      background: #ddd;
      padding: 5px;
      margin: 5px;
      cursor: pointer;
    }
    .toggle {
      position: absolute;
      bottom: 20px;
      right: 10px;
    }
  </style>
</head>
<body>
<div id='map'></div>
<div class='start-draw' >
  <div id='start-point'>POINT</div>
  <div id='start-line'>LINE</div>
  <div id='start-polygon'>POLYGON</div>
</div>
<div class='toggle'>
  <button id='addBtn'>add draw</button>
  <button id='removeBtn'>remove draw</button>
  <button id='flipStyleBtn'>change style</button>
</div>
<script src='/mapbox-gl.js'></script>
<script src='/mapbox-gl-draw.js'></script>
<script type='text/javascript'>
// making run more like github.com/mapbox/mapbox-gl-js
//eg http://127.0.0.1:9966/debug/?access_token=<the-token>#13/37.76/-122.42
var args = location.search.replace(/^\?/,'').split('&').reduce(function(o, param){ var keyvalue=param.split('='); o[keyvalue[0]] = keyvalue[1]; return o; }, {});
mapboxgl.accessToken = args.access_token || localStorage.accessToken;
// could work this further but going off the above example
location.hash.replace(/^#/,'').split('/').reduce(function(args, val, i, hash){
  switch(i){
  case 0: args.zoom = val; break;
  case 1: args.latitude = val; break;
  case 2:
    args.longitude = val;
    if(args.latitude) args.latlng = [val, args.latitude];
  break;
  };
  return args;
}, args);

  var map = new mapboxgl.Map({
    container: 'map',
    zoom: args.zoom || 1,
    center: args.latlng || [0, 0],
    style: 'mapbox://styles/mapbox/streets-v8'
  });

  map.addControl(new mapboxgl.NavigationControl(), 'top-left');
  map.showTileBoundaries = true;

  var Draw = window.Draw = new MapboxDraw();
  var drawIsActive = true;
  map.addControl(Draw, 'bottom-right');

  map.on('load', function() {

    // toggle
    var addButton = document.getElementById('addBtn');
    var removeButton = document.getElementById('removeBtn');
    var flipStyleButton = document.getElementById('flipStyleBtn');
    var currentStyle = 'streets-v9';
    addButton.onclick = function() {
      if (drawIsActive) return;
      drawIsActive = true;
      map.addControl(Draw, 'bottom-right');
    }
    removeButton.onclick = function() {
      if (!drawIsActive) return;
      drawIsActive = false;
      map.removeControl(Draw);
    }
    flipStyleButton.onclick = function() {
      var style = currentStyle === 'streets-v9' ? 'dark-v9' : 'streets-v9';
      map.setStyle('mapbox://styles/mapbox/' + style);
      currentStyle = style;
    }

    var startPoint = document.getElementById('start-point');
    var startLine = document.getElementById('start-line');
    var startPolygon = document.getElementById('start-polygon');


    startPoint.onclick = function() {
      Draw.changeMode('draw_point');
    };

    startLine.onclick = function() {
      Draw.changeMode('draw_line_string');
    };

    startPolygon.onclick = function() {
      Draw.changeMode('draw_polygon');
    };

//      map.addLayer({
//          'id': 'texas',
//          'type': 'fill',
//          'source': {
//              'type': 'geojson',
//              'data': {
//                  'type': 'Feature',
//                  'geometry': {
//                      'type': 'Polygon',
//                      'coordinates':[[[-98.45006526588936,29.635700803445673],[-98.45005644483969,29.635697193299833],[-98.45005342735635,29.635698358969762],[-98.45005443318414,29.63570360449583],[-98.45005353201942,29.635706373865276],[-98.44996619256725,29.635701565459755],[-98.44996418091169,29.635698359855965],[-98.44995714011057,29.635698359855965],[-98.44995546373093,29.63569515426363],[-98.4499500993161,29.635696028516108],[-98.44995244624758,29.635702148294698],[-98.44994574072238,29.635702439712162],[-98.44994741710202,29.6357068109741],[-98.44995345207536,29.635705353886834],[-98.44995546373093,29.635709433731165],[-98.44996116342834,29.635708559478815],[-98.4499588164902,29.635703313964555],[-98.45005034687816,29.63570768522648],[-98.45004638655523,29.63571292985428],[-98.4500410221404,29.635714095524023],[-98.45004437489966,29.635716718280918],[-98.45003827693148,29.635719633352892],[-98.45003257724072,29.635717884836794],[-98.45002453061183,29.635720507605143],[-98.45001983674885,29.635728667292454],[-98.4500035291778,29.635726112517],[-98.44999737324842,29.635727501622895],[-98.44999167355101,29.635728667292454],[-98.44998692452873,29.635731847024232],[-98.44996479630424,29.635748457825244],[-98.44996082815241,29.63574790085009],[-98.44995680483464,29.635746443763367],[-98.44995177569574,29.635747318015433],[-98.44994272323905,29.63574760943274],[-98.44993266495459,29.63575110644075],[-98.44993337890966,29.635745919315923],[-98.44992868504669,29.63573688536634],[-98.44991896203814,29.635717068971772],[-98.4499129270648,29.63570395518674],[-98.4499098843259,29.6357071787394],[-98.44990454516662,29.635707160778807],[-98.44990320406292,29.63570395518674],[-98.44989247522659,29.63570395518674],[-98.44987705252065,29.63570949211841],[-98.44988308749399,29.63572289733169],[-98.44987302920953,29.635722314496874],[-98.4498673295121,29.63572377158394],[-98.44986196509727,29.635727268592774],[-98.44986397675284,29.63573892528791],[-98.44986800006396,29.635744170811876],[-98.44987202338174,29.635750873410643],[-98.44987671724473,29.63575582750508],[-98.4498857697014,29.635761655862765],[-98.44989716908958,29.635761655862765],[-98.44990588627033,29.63575874167819],[-98.4499042098907,29.63575524467045],[-98.44990923902961,29.635754953253127],[-98.4499182914863,29.63575582750508],[-98.44992633811519,29.63575466183582],[-98.44993025024372,29.635756922943642],[-98.44992294193099,29.635758391800536],[-98.44991556586059,29.63575897463511],[-98.44990517230019,29.635761888808133],[-98.44990349592055,29.63576509439831],[-98.44989813149907,29.635765385815617],[-98.44988874376645,29.63576829998844],[-98.4498867321109,29.635771214172735],[-98.4498858768593,29.6357753027245],[-98.44987362284134,29.635776750503126],[-98.44986591148836,29.635779081841136],[-98.44986356455688,29.635783453099734],[-98.4498588706939,29.635783453099734],[-98.44983906783763,29.635788382196523],[-98.44983237421685,29.635783763121935],[-98.44982835090572,29.635775603427504],[-98.44982307306313,29.635770398381297],[-98.4498164386669,29.6357586964859],[-98.44981091654421,29.63574471318202],[-98.4498058874053,29.635745296016722],[-98.44980320519788,29.635741798996975],[-98.44979884660417,29.635742381831662],[-98.44978912360229,29.635743256083714],[-98.44977973586968,29.635749375859447],[-98.44978308862895,29.635758409796367],[-98.44978107697338,29.63576132396939],[-98.44978979415414,29.635775894844755],[-98.44979649967269,29.635780557520746],[-98.44979884660417,29.635788134380363],[-98.44980689323307,29.635790465718074],[-98.44981862789717,29.635790465718074],[-98.4498250048328,29.6357944524232],[-98.44978508833113,29.635811682184183],[-98.44977699556225,29.635810027564247],[-98.44976861365743,29.635806530558327],[-98.44975759569179,29.635813430687094],[-98.4497522312703,29.63581663627565],[-98.44973877399748,29.635791685271784],[-98.44973307430672,29.635780319999952],[-98.44972871571967,29.635780319999952],[-98.44972201019448,29.63577915433099],[-98.44971429884149,29.635781485668915],[-98.44971195191002,29.63578731401354],[-98.4497131596988,29.6357843146038],[-98.44970696207922,29.63578165673087],[-98.44969958600217,29.635786027989354],[-98.4496985801744,29.63579477050581],[-98.44969891545033,29.63580234736429],[-98.44969690379476,29.63580613578756],[-98.44969388631141,29.635802930198665],[-98.44968651023437,29.635800307444015],[-98.44968952772436,29.63579710184335],[-98.44968248692324,29.635796519009006],[-98.44968215164731,29.635791856333725],[-98.44967611667397,29.63579127349935],[-98.44966398643722,29.635790788781563],[-98.44966398643722,29.635797199971606],[-98.44966029840202,29.635795742885648],[-98.44965191649717,29.635796325720023],[-98.44965158122126,29.63579865705755],[-98.44964487570272,29.635799239891924],[-98.4496391760053,29.635803319732517],[-98.4496391760053,29.635805359652707],[-98.44964454042679,29.635807982407187],[-98.4496509106694,29.63580681673855],[-98.44964856373792,29.635810605161637],[-98.44965292232496,29.63581118799594],[-98.44965795147053,29.63581381076183],[-98.44965593981497,29.635817890601842],[-98.44966365116129,29.635816142099003],[-98.44966868030686,29.63581701635043],[-98.44967069196241,29.63582138760735],[-98.44967572110131,29.635821679024517],[-98.4496797444191,29.63582051335598],[-98.4496778961781,29.6358245737688],[-98.44961874514843,29.635821409878844],[-98.44961237489916,29.63580917034733],[-98.44960467220244,29.63579192865872],[-98.44960031360874,29.635784934645486],[-98.44959394336611,29.63576948951956],[-98.44959092587612,29.635759289914446],[-98.44958507094039,29.635747158169863],[-98.44958205345705,29.635738124220353],[-98.44958305928482,29.635724719020672],[-98.44956864240666,29.63569412016551],[-98.44956629547517,29.635688583233033],[-98.44956260743996,29.635683337717722],[-98.44956093106033,29.63568013211335],[-98.44956864240666,29.635675178015177],[-98.44956864240666,29.635681006365928],[-98.44957333627627,29.635681589201],[-98.44957534793187,29.63568071494845],[-98.44957300100036,29.63567372092743],[-98.44957870069112,29.635671389586975],[-98.44958708259597,29.635682463465145],[-98.44958540621631,29.6356842119703],[-98.4495827240089,29.635681589201],[-98.44957601848371,29.635686251892906],[-98.44957568320778,29.63568916606802],[-98.4495783654152,29.635693537330525],[-98.44958205345705,29.635693537330525],[-98.4495840651126,29.635695868670467],[-98.44958138289854,29.63570286270145],[-98.44958339456076,29.635709565302975],[-98.44958674732003,29.63571451939947],[-98.44958808842374,29.635719764913134],[-98.44959110590707,29.635720930582778],[-98.4495961202788,29.63572399770385],[-98.44959814670818,29.635727050359904],[-98.4496018347434,29.63573054736858],[-98.44960384639896,29.635733461542415],[-98.44960820499267,29.635735210046676],[-98.44961088720007,29.635736958550908],[-98.44962145436024,29.635734273379967],[-98.44962761859021,29.635736356992453],[-98.44963446772707,29.635733678050244],[-98.44963549509758,29.635737845287082],[-98.44965261795335,29.635731296778758],[-98.44964439898231,29.635714627876666],[-98.44963926212966,29.635698554278065],[-98.44963652246813,29.635687838540292],[-98.44962693367651,29.63568575492681],[-98.44962248173077,29.63568367131326],[-98.44975304427965,29.635636710868454],[-98.44975639703893,29.635638167956785],[-98.44976109090854,29.63563991646265],[-98.44976109090854,29.63564253922148],[-98.44976578477153,29.635641664968546],[-98.44976880225488,29.635646327662315],[-98.44977517245962,29.635639624927904],[-98.44977517245962,29.635648076039388],[-98.44978154270223,29.635647493204132],[-98.44978523073743,29.635645453280745],[-98.44979025988299,29.635643996192556],[-98.4497916009867,29.635639042081024],[-98.44979093043486,29.6356358364868],[-98.44979797123597,29.635638459245726],[-98.44979897706375,29.63563321372783],[-98.44980132399525,29.63563671073979],[-98.44980501203042,29.63563321372783],[-98.44980836479635,29.63563029955111],[-98.44981037645192,29.635628551045016],[-98.44981339393527,29.635632630892502],[-98.44981473503897,29.635630008133404],[-98.44980802951378,29.635617477160892],[-98.4498660322891,29.63559649507178],[-98.44986972032427,29.635597660742846],[-98.44987206725577,29.63559562081845],[-98.44987575529763,29.635596786489543],[-98.44987910805689,29.635601449185415],[-98.44988782523764,29.635603197691935],[-98.44989486603212,29.63560756895815],[-98.44989352492841,29.6356029062742],[-98.44989687768768,29.635598243578414],[-98.44990056572952,29.635595912236212],[-98.44989453075618,29.63558979246274],[-98.44990023045361,29.635589209627128],[-98.44990324793694,29.635593580893982],[-98.44990660069622,29.635593580893982],[-98.44990995346214,29.635590958133903],[-98.44990794179992,29.635582798435436],[-98.44996460347153,29.635562982010526],[-98.44996862678263,29.635565313353467],[-98.44996963261043,29.635567644696337],[-98.44997265009377,29.635562982010526],[-98.44997432647341,29.635559776402317],[-98.44997834979118,29.63556647902493],[-98.4499800261708,29.635561233491714],[-98.44998404948194,29.63556210775691],[-98.44998371420601,29.635567644696337],[-98.44998807279973,29.63556356484628],[-98.44999109028306,29.63556356484628],[-98.44999310193863,29.635565896189206],[-98.44999544887011,29.63556968462136],[-98.44999746052568,29.635573181635507],[-98.4500001183267,29.635570022807684],[-98.4500024652582,29.635574394086902],[-98.4500074943971,29.635580222443537],[-98.45000481218969,29.635581096696995],[-98.45001051188709,29.63558342803951],[-98.45001654685377,29.635591296320158],[-98.4500222465512,29.635593627673984],[-98.4500294671394,29.6355929788611],[-98.45003062844938,29.63559537618066],[-98.45003934563013,29.635593044826862],[-98.45006265920868,29.635658888226473],[-98.45005440474714,29.635661153912878],[-98.45004441249566,29.63566568528536],[-98.45005397030181,29.635687209317197],[-98.4500587492006,29.63568909738862],[-98.45006526588936,29.635700803445673]]]
//                  }
//              }
//          },
//          'layout': {},
//          'paint': {
//              'fill-color': '#088',
//              'fill-opacity': 0.8
//          }
//      });


//      const geojson = {
//                  'type': 'Feature',
//                  "id": "foo",
//                   'properties': {"id": "foo"},
//                  'geometry': {
//                      'type': 'Polygon',
//                      "coordinates": [
//                          [
//                              [
//                                  -98.66663842547213,
//                                  29.45643474103916
//                              ],
//                              [
//                                  -98.66679694345878,
//                                  29.456371984521155
//                              ],
//                              [
//                                  -98.66680797889519,
//                                  29.456362321178204
//                              ],
//                              [
//                                  -98.66681726364592,
//                                  29.456361586221448
//                              ],
//                              [
//                                  -98.66683076874284,
//                                  29.45634909197362
//                              ],
//                              [
//                                  -98.66683752129128,
//                                  29.45635276674868
//                              ],
//                              [
//                                  -98.66684849418047,
//                                  29.45635056187801
//                              ],
//                              [
//                                  -98.66686115520817,
//                                  29.45634247736122
//                              ],
//                              [
//                                  -98.66687550437429,
//                                  29.4563343928438
//                              ],
//                              [
//                                  -98.66687888064583,
//                                  29.45632777823991
//                              ],
//                              [
//                                  -98.66689660608348,
//                                  29.456331453015736
//                              ],
//                              [
//                                  -98.66706200228786,
//                                  29.456262815304
//                              ],
//                              [
//                                  -98.66706959890013,
//                                  29.45625546573784
//                              ],
//                              [
//                                  -98.66708648027397,
//                                  29.456252525907473
//                              ],
//                              [
//                                  -98.667088168407,
//                                  29.456240766594505
//                              ],
//                              [
//                                  -98.66710673791391,
//                                  29.456242236509894
//                              ],
//                              [
//                                  -98.66712699555926,
//                                  29.456236356848237
//                              ],
//                              [
//                                  -98.66713628030999,
//                                  29.456224597533378
//                              ],
//                              [
//                                  -98.66714303285845,
//                                  29.456221657711552
//                              ],
//                              [
//                                  -98.66715231761462,
//                                  29.456212103268726
//                              ],
//                              [
//                                  -98.66716666678076,
//                                  29.45620475368945
//                              ],
//                              [
//                                  -98.66712446335158,
//                                  29.45611435390579
//                              ],
//                              [
//                                  -98.66697253102494,
//                                  29.456173885479032
//                              ],
//                              [
//                                  -98.6665888703612,
//                                  29.45632965201166
//                              ],
//                              [
//                                  -98.6666086946991,
//                                  29.4563716924863
//                              ],
//                              [
//                                  -98.66663842547213,
//                                  29.45643474103916
//                              ]				]
//                      ]
//                     }
//              };
//
//    Draw.add(geojson);
//    Draw.changeMode('draw_polygon', { featureId: "foo" });
//

//    const geojson = {
//      type: 'Feature',
//      id: "foo",
//      properties: {},
//      geometry: {
//        type: 'LineString',
//        coordinates: [
//          [-122.48369693756104, 37.83381888486939],
//          [-122.48339653015138, 37.83270036637107],
//          [-122.48356819152832, 37.832056363179625],
//          [-122.49378204345702, 37.83368330777276]
//        ]
//      }
//    };
//
//    Draw.add(geojson);
//    Draw.changeMode('draw_line_string', { featureId: "foo", from: [-122.48369693756104, 37.83381888486939] });

  });

  var loadData = function(uri) {
  var req = new XMLHttpRequest();
  req.onerror = function() {
    throw new Error('Network Error');
  };
  req.onload = function() {
    var fc = JSON.parse(req.response);
    fc.features.forEach(function(feature) {
      if(feature.geometry.type.startsWith('Multi') === false) {
        Draw.add(feature);
      }
    });

  };
  req.open('GET', uri);
  req.send();
}

// loadData('https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_50m_geography_regions_polys.geojson');

console.log('use `loadData(url)` to load in FeatureCollections to Draw via url');
console.log('5.51MB Polygons - https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_50m_geography_regions_polys.geojson');

console.log('4.99MB LineStirings - https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_10m_rivers_north_america.geojson');

console.log('4.03MB Points - https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_10m_admin_1_label_points.geojson');

  (function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();stats.domElement.style.cssText='position:fixed;right:0;top:0;z-index:10000';document.body.appendChild(stats.domElement);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='//rawgit.com/mrdoob/stats.js/master/build/stats.min.js';document.head.appendChild(script);})();
</script>
</body>
</html>
